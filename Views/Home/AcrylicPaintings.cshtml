<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acrylic Paintings</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
        }

        .acrylic-painting-section {
            padding: 40px 20px;
            text-align: left;
        }

        .section-header {
            text-align: center;
            margin-bottom: 30px;
        }

            .section-header .line {
                display: inline-block;
                width: 80px;
                height: 3px;
                background-color: #333;
                margin: 0 auto 10px;
            }

            .section-header h2 {
                font-size: 2.5em;
                color: #333;
                margin: 0;
            }

        .artwork-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            justify-content: center;
            padding: 0 10px;
        }

        .artwork-card {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            max-width: 300px;
            margin: auto;
        }

            .artwork-card:hover {
                transform: scale(1.05);
                box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            }

            .artwork-card img {
                width: 300px;
                height: 300px;
                object-fit: cover;
                border-bottom: 1px solid #ddd;
            }

            .artwork-card h3 {
                font-size: 1.2em;
                margin: 10px 0 5px;
                color: #333;
            }

            .artwork-card p {
                margin: 5px 0;
                color: #666;
                font-size: 0.9em;
            }

                .artwork-card p:last-child {
                    font-weight: bold;
                    color: #000;
                }

            .artwork-card .artist-name {
                font-style: italic;
                color: #555;
            }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .artwork-card:hover .overlay {
            opacity: 1;
        }

        .overlay button {
            background-color: black;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-size: 1em;
            border-radius: 5px;
        }

            .overlay button:hover {
                background-color: white;
                color: black;
            }

        .overlay .view-btn {
            background-color: #ccc;
            color: #000;
        }

            .overlay .view-btn:hover {
                background-color: #666;
                color: #fff;
            }
    </style>
</head>
<body>
    <div class="acrylic-painting-section">
        <div class="section-header">
            <div class="line"></div>
            <h2>Acrylic Paintings</h2>
        </div>
        <div class="artwork-container" id="artworkContainer">
            <!-- Static Artwork Cards -->
            <div class="artwork-card">
                <img src="/Images/Shreenathji.jpg" alt="Shree Nathji">
                <div class="overlay">
                    <button class="view-btn">View</button>
                    <button class="add-to-cart-btn">Add to Cart</button>
                </div>
                <h3>Shree Nathji</h3>
                <p class="artist-name">Ayushi Babariya</p>
                <p>INR 4500</p>
            </div>
            <div class="artwork-card">
                <img src="/Images/gouachepainting.jpg" alt="Gouache Painting">
                <div class="overlay">
                    <button class="view-btn">View</button>
                    <button class="add-to-cart-btn">Add to Cart</button>
                </div>
                <h3>Gouache Painting</h3>
                <p class="artist-name">Ayushi Babariya</p>
                <p>INR 1000</p>
            </div>
            <div class="artwork-card">
                <img src="/Images/Ganpatibappa.jpg" alt="Ganpati Bappa">
                <div class="overlay">
                    <button class="view-btn">View</button>
                    <button class="add-to-cart-btn">Add to Cart</button>
                </div>
                <h3>Ganpati Bappa</h3>
                <p class="artist-name">Niyati Agravat</p>
                <p>INR 700</p>
            </div>
            <div class="artwork-card">
                <img src="/Images/HousePainting.jpg" alt="House Painting">
                <div class="overlay">
                    <button class="view-btn">View</button>
                    <button class="add-to-cart-btn">Add to Cart</button>
                </div>
                <h3>House Painting</h3>
                <p class="artist-name">Niyati Agravat</p>
                <p>INR 700</p>
            </div>
            <div class="artwork-card">
                <img src="/Images/SunrisePainting.jpg" alt="Sunrise Painting">
                <div class="overlay">
                    <button class="view-btn">View</button>
                    <button class="add-to-cart-btn">Add to Cart</button>
                </div>
                <h3>Sunrise Painting</h3>
                <p class="artist-name">Niyati Agravat</p>
                <p>INR 700</p>
            </div>
            <div class="artwork-card">
                <img src="/Images/RainyDay.jpg" alt="Rainy Day">
                <div class="overlay">
                    <button class="view-btn">View</button>
                    <button class="add-to-cart-btn">Add to Cart</button>
                </div>
                <h3>Rainy Day</h3>
                <p class="artist-name">Niyati Agravat</p>
                <p>INR 700</p>
            </div>
            <div class="artwork-card">
                <img src="/Images/Acraylic Painting.jpeg" alt="Acraylic">
                <div class="overlay">
                    <button class="view-btn">View</button>
                    <button class="add-to-cart-btn">Add to Cart</button>
                </div>
                <h3>Acraylic</h3>
                <p class="artist-name">Niyati Agravat</p>
                <p>INR 700</p>
            </div>

            <!-- Dynamic Artwork Cards from Database -->
            @model List<RangShala.Models.Artwork>
            @if (Model != null && Model.Any())
            {
                @foreach (var artwork in Model)
                {
                    <div class="artwork-card">
                        <img src="@Url.Content(artwork.PaintingImage)" alt="@artwork.PaintingName"
                             onerror="this.onerror=null; this.src='/Images/placeholder.jpg';">
                        <div class="overlay">
                            <button class="view-btn">View</button>
                            <button class="add-to-cart-btn">Add to Cart</button>
                        </div>
                        <h3>@artwork.PaintingName</h3>
                        <p class="artist-name">@artwork.ArtistName</p>
                        <p>INR @artwork.PaintingPrice</p>
                    </div>
                }
            }
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            function refreshArtworks() {
                $.ajax({
                    url: '/Home/GetAcrylicPaintings',
                    type: 'GET',
                    success: function (data) {
                        // Append dynamic artworks after static ones
                        $("#artworkContainer").find('.dynamic-artwork').remove(); // Remove previous dynamic cards
                        $("#artworkContainer").append('<div class="dynamic-artwork">' + data + '</div>');
                        bindCartEvents(); // Re-bind events for new dynamic cards
                    },
                    error: function () {
                        console.log("Failed to refresh artworks.");
                    }
                });
            }

            function bindCartEvents() {
                $(".add-to-cart-btn").click(function () {
                    var button = $(this);
                    var itemName = button.closest(".artwork-card").find("h3").text();
                    var itemPrice = button.closest(".artwork-card").find("p:last").text().replace("INR ", "");

                    $.ajax({
                        url: '/Cart/IsUserLoggedIn',
                        type: 'GET',
                        success: function (isLoggedIn) {
                            if (isLoggedIn) {
                                addToCart(itemName, itemPrice);
                            } else {
                                sessionStorage.setItem("pendingCartItem", JSON.stringify({ name: itemName, price: itemPrice }));
                                window.location.href = '/Account/Login';
                            }
                        },
                        error: function () {
                            alert("Error checking login status.");
                        }
                    });
                });
            }

            function addToCart(name, price) {
                $.ajax({
                    url: '/Cart/AddToCart',
                    type: 'POST',
                    contentType: "application/json",
                    data: JSON.stringify({ name: name, price: price }),
                    success: function (response) {
                        if (response.success) {
                            alert(response.message);
                        } else {
                            alert("Failed to add to cart: " + response.message);
                        }
                    },
                    error: function () {
                        alert("Failed to add to cart. Try again.");
                    }
                });
            }

            // Check for pending cart item after login
            var pendingItem = sessionStorage.getItem("pendingCartItem");
            if (pendingItem) {
                var item = JSON.parse(pendingItem);
                addToCart(item.name, item.price);
                sessionStorage.removeItem("pendingCartItem");
            }

            // Refresh artworks if a new one was added
            if (sessionStorage.getItem("newArtworkAdded")) {
                refreshArtworks();
                sessionStorage.removeItem("newArtworkAdded");
            }

            // Initial binding of cart events for static and existing dynamic cards
            bindCartEvents();
        });
    </script>
</body>
</html>